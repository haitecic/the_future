<!DOCTYPE html>
<html>
<head>    
<meta charset="utf-8">
<meta property="og:title" content="投家，鬥陣選總統" />
<meta property="og:description" content="" />
<meta property="og:site_name" content="投家，鬥陣選總統" />
<meta property="og:url" content="" />
<meta property="og:image" content="" />
<meta property="og:type" content="website" />
<meta property="fb:app_id" content="1109820955698868">
<title>投家，鬥陣選總統</title>	
<link rel="stylesheet" href="bootstrap/css/bootstrap.min.css" />
<link rel="stylesheet" href="css/animate.css" />
<link rel="stylesheet" href="alertifyjs/css/alertify.css" />
<link rel="stylesheet" href="css/fightgame.css" />
</head>
<body>
	<img class="stepBar" src="image/step_1.jpg" />
	<img class="loading" src="image/loading.gif" style="display:none"/>
	<div id="beforegame" style="">	
		<div id="optiontext">		
			<h1>你/妳認為理想的<br><span>總統候選人</span><br>應該具備什麼<br><div>特質</div></h1>
			<div class="othertext" style="display:none">我覺得還有：<input type="text" maxlength="12" name="personality" value="" /></div>	
		</div>
		<button id="confirmPersonality" type="button" class="btn btn-default">確認</button>
		<div id="nominatetext">
			<h1>你有沒有心目中的<br><span>王牌候選人</span></h1>
		</div>
		<div class="nominateBtn">
			<div>
				<button class="btn btn-default" data-toggle="modal" data-target="#nominateModal">有</button>
				<p>召喚他加入戰局</p>
			</div>
			<div>
				<button id="goToPlay" class="btn btn-default">沒有</button>
				<p>開始二選一PK戰</p>
			</div>
		</div>
		
		<div class="optionform">
			<ul>
				<label><li><span>王室血統</span><input type="checkbox" name="personality" value="王室血統" /></li></label>
				<label><li><span>平民出身</span><input type="checkbox" name="personality" value="草莽出身" /></li></label>
				<label><li><span>經歷啟蒙<br>有思想</span><input type="checkbox" name="personality" value="經歷啟蒙" /></li></label>
				<label><li><span>領導魅力<br>千呼萬應</span><input type="checkbox" name="personality" value="領導魅力" /></li></label>
				<label><li><span>不會太老</span><input type="checkbox" name="personality" value="一表人才" /></li></label>
				<label><li><span>學富五車<br>有內涵</span><input type="checkbox" name="personality" value="學富五車有內涵" /></li></label>
				<label><li><span>黑白兩道<br>通吃!</span><input type="checkbox" name="personality" value="黑白兩道通吃" /></li></label>
				<label><li><span>八面玲瓏</span><input type="checkbox" name="personality" value="八面玲瓏" /></li></label>
				<label><li><span>說到做到</span><input type="checkbox" name="personality" value="說到做到" /></li></label>
				<label><li><span>不容易流淚</span><input type="checkbox" name="personality" value="不容易流淚" /></li></label>
				<label><li><span>女兒身</span><input type="checkbox" name="personality" value="女兒身" /></li></label>
				<label><li><span>一步一腳印</span><input type="checkbox" name="personality" value="一步一腳印" /></li></label>
				<label><li><span>說話不轉彎</span><input type="checkbox" name="personality" value="說話不轉彎" /></li></label>
				<label><li><span>體恤民意</span><input type="checkbox" name="personality" value="體恤民意" /></li></label>
				<label><li><span>看得高<br>望得遠</span><input type="checkbox" name="personality" value="看得高望得遠" /></li></label>
				<label><li><span>┼</span><input id="otherBtn" type="checkbox" name="personality" value="other" /></li></label>
			</ul>
		</div>
		
		<div class="modal fade" id="nominateModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
		  <div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					<h4 class="modal-title" id="myModalLabel">召喚王牌候選人</h4>
				</div>
				<div class="modal-body">
					<span>姓名：</span>
					<input id="nominate_name" type="text" name="newname" size=20 value="" />
					<div id="validate" type="button" class="btn btn-default">認證</div>
					<span id="wait"></span>	
					<div id="nominatingText">
					<div>為了符合客觀公正及真實性，被提名的人選須要符合以下的條件</div>
					<div>1. 有wiki頁面(沒有嗎？馬上去建一個)</div>
					<div>2. 還活著(你以為你在玩陰屍路嗎？請找活人參戰)</div>
					<div>3. 不能是虛構人物(醒醒吧！)</div>
					<div>4. 必須有台灣國籍(這是一定要的啦！)</div>
					<br>
					<div>本站之人物簡介皆來自維基百科，每日定期更新</div>
					<div>管理者將定期檢核人物是否符合以上資格</div>
					</div>
				</div>
				<div class="modal-footer">
					<div id="nominateAction" style="display:none">
					<button id="submitNominate" type="button" class="btn btn-default" data-dismiss="modal">確認</button>
					<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
					</div>
				</div>
			</div>
		  </div>
	    </div>
	</div>
	


	<div id="game" style="display:none">
	<h2>你選誰</h2>
		<div id="candidate_1" class="Left candidate_per" value="1">	
			<img id="image_1" class="personImg img-responsive center-block" src="" alt="" />			
			<div class="canName"></div>					
			<div class="canBrief"><a href="" target="_blank">維基百科</a></div>					
			<hr>
			<div class="news">
				<i class="fa fa-arrow-up" id="nt-example1-prev"></i>
	            <ul id="nt-example1">
					<li>
						<div class="news1title"><a href="" target="_blank"></a></div>
						<div class="news1source"></div>
					</li>					
					<li>
						<div class="news2title"><a href="" target="_blank"></a></div>
						<div class="news2source"></div>
					</li>					
					<li>
						<div class="news3title"><a href="" target="_blank"></a></div>
						<div class="news3source"></div>
					</li>
					<li>
						<div class="news4title"><a href="" target="_blank"></a></div>
						<div class="news4source"></div>
					</li>
					<li>
						<div class="news5title"><a href="" target="_blank"></a></div>
						<div class="news5source"></div>
					</li>
				</ul>
				 <i class="fa fa-arrow-down" id="nt-example1-next"></i>
			</div>	 
		</div>		
		<!--
		<div class="col-md-2">
		<h1 class="text-center vsh1">vs</h1>
		</div>
		-->
		<div id="candidate_2" class="Right candidate_per" value="2">	
			<img id="image_2" class="personImg img-responsive center-block" src="" alt="" />			
			<div class="canName"></div>					
			<div class="canBrief"><a href="" target="_blank">維基百科</a></div>					
			<hr>
			<div class="news">
				<i class="fa fa-arrow-up" id="nt-example1-prev"></i>
	            <ul id="nt-example1">
					<li>
						<div class="news1title"><a href="" target="_blank"></a></div>
						<div class="news1source"></div>
					</li>					
					<li>
						<div class="news2title"><a href="" target="_blank"></a></div>
						<div class="news2source"></div>
					</li>					
					<li>
						<div class="news3title"><a href="" target="_blank"></a></div>
						<div class="news3source"></div>
					</li>
					<li>
						<div class="news4title"><a href="" target="_blank"></a></div>
						<div class="news4source"></div>
					</li>
					<li>
						<div class="news5title"><a href="" target="_blank"></a></div>
						<div class="news5source"></div>
					</li>
				</ul>
				 <i class="fa fa-arrow-down" id="nt-example1-next"></i>
			</div>	 
		</div>		
		
		<div id="candidate_3" class="readytofight candidate_per" value="3">	
			<img id="image_3" class="personImg img-responsive center-block" src="" alt="" />			
			<div class="canName"></div>					
			<div class="canBrief"><a href="" target="_blank">維基百科</a></div>					
			<hr>
			<div class="news">
				<i class="fa fa-arrow-up" id="nt-example1-prev"></i>
	            <ul id="nt-example1">
					<li>
						<div class="news1title"><a href="" target="_blank"></a></div>
						<div class="news1source"></div>
					</li>					
					<li>
						<div class="news2title"><a href="" target="_blank"></a></div>
						<div class="news2source"></div>
					</li>					
					<li>
						<div class="news3title"><a href="" target="_blank"></a></div>
						<div class="news3source"></div>
					</li>
					<li>
						<div class="news4title"><a href="" target="_blank"></a></div>
						<div class="news4source"></div>
					</li>
					<li>
						<div class="news5title"><a href="" target="_blank"></a></div>
						<div class="news5source"></div>
					</li>
				</ul>
				 <i class="fa fa-arrow-down" id="nt-example1-next"></i>
			</div>	 
		</div>
		
		<div id="candidate_4" class="readytofight candidate_per" value="4">	
			<img id="image_4" class="personImg img-responsive center-block" src="" alt="" />			
			<div class="canName"></div>					
			<div class="canBrief"><a href="" target="_blank">維基百科</a></div>					
			<hr>
			<div class="news">
				<i class="fa fa-arrow-up" id="nt-example1-prev"></i>
	            <ul id="nt-example1">
					<li>
						<div class="news1title"><a href="" target="_blank"></a></div>
						<div class="news1source"></div>
					</li>					
					<li>
						<div class="news2title"><a href="" target="_blank"></a></div>
						<div class="news2source"></div>
					</li>					
					<li>
						<div class="news3title"><a href="" target="_blank"></a></div>
						<div class="news3source"></div>
					</li>
					<li>
						<div class="news4title"><a href="" target="_blank"></a></div>
						<div class="news4source"></div>
					</li>
					<li>
						<div class="news5title"><a href="" target="_blank"></a></div>
						<div class="news5source"></div>
					</li>
				</ul>
				 <i class="fa fa-arrow-down" id="nt-example1-next"></i>
			</div>	 
		</div>	

		<div id="candidate_5" class="readytofight candidate_per" value="5">	
			<img id="image_5" class="personImg img-responsive center-block" src="" alt="" />			
			<div class="canName"></div>					
			<div class="canBrief"><a href="" target="_blank">維基百科</a></div>					
			<hr>
			<div class="news">
				<i class="fa fa-arrow-up" id="nt-example1-prev"></i>
	            <ul id="nt-example1">
					<li>
						<div class="news1title"><a href="" target="_blank"></a></div>
						<div class="news1source"></div>
					</li>					
					<li>
						<div class="news2title"><a href="" target="_blank"></a></div>
						<div class="news2source"></div>
					</li>					
					<li>
						<div class="news3title"><a href="" target="_blank"></a></div>
						<div class="news3source"></div>
					</li>
					<li>
						<div class="news4title"><a href="" target="_blank"></a></div>
						<div class="news4source"></div>
					</li>
					<li>
						<div class="news5title"><a href="" target="_blank"></a></div>
						<div class="news5source"></div>
					</li>
				</ul>
				 <i class="fa fa-arrow-down" id="nt-example1-next"></i>
			</div>	 
		</div>		
		
		<div id="candidate_6" class="readytofight candidate_per" value="6">	
			<img id="image_6" class="personImg img-responsive center-block" src="" alt="" />			
			<div class="canName"></div>					
			<div class="canBrief"><a href="" target="_blank">維基百科</a></div>					
			<hr>
			<div class="news">
				<i class="fa fa-arrow-up" id="nt-example1-prev"></i>
	            <ul id="nt-example1">
					<li>
						<div class="news1title"><a href="" target="_blank"></a></div>
						<div class="news1source"></div>
					</li>					
					<li>
						<div class="news2title"><a href="" target="_blank"></a></div>
						<div class="news2source"></div>
					</li>					
					<li>
						<div class="news3title"><a href="" target="_blank"></a></div>
						<div class="news3source"></div>
					</li>
					<li>
						<div class="news4title"><a href="" target="_blank"></a></div>
						<div class="news4source"></div>
					</li>
					<li>
						<div class="news5title"><a href="" target="_blank"></a></div>
						<div class="news5source"></div>
					</li>
				</ul>
				 <i class="fa fa-arrow-down" id="nt-example1-next"></i>
			</div>	 
		</div>	
		
		<div id="candidate_7" class="readytofight candidate_per" value="7">	
			<img id="image_7" class="personImg img-responsive center-block" src="" alt="" />			
			<div class="canName"></div>					
			<div class="canBrief"><a href="" target="_blank">維基百科</a></div>					
			<hr>
			<div class="news">
				<i class="fa fa-arrow-up" id="nt-example1-prev"></i>
	            <ul id="nt-example1">
					<li>
						<div class="news1title"><a href="" target="_blank"></a></div>
						<div class="news1source"></div>
					</li>					
					<li>
						<div class="news2title"><a href="" target="_blank"></a></div>
						<div class="news2source"></div>
					</li>					
					<li>
						<div class="news3title"><a href="" target="_blank"></a></div>
						<div class="news3source"></div>
					</li>
					<li>
						<div class="news4title"><a href="" target="_blank"></a></div>
						<div class="news4source"></div>
					</li>
					<li>
						<div class="news5title"><a href="" target="_blank"></a></div>
						<div class="news5source"></div>
					</li>
				</ul>
				 <i class="fa fa-arrow-down" id="nt-example1-next"></i>
			</div>	 
		</div>	
		
		<div id="candidate_8" class="readytofight candidate_per" value="8">	
			<img id="image_8" class="personImg img-responsive center-block" src="" alt="" />			
			<div class="canName"></div>					
			<div class="canBrief"><a href="" target="_blank">維基百科</a></div>					
			<hr>
			<div class="news">
				<i class="fa fa-arrow-up" id="nt-example1-prev"></i>
	            <ul id="nt-example1">
					<li>
						<div class="news1title"><a href="" target="_blank"></a></div>
						<div class="news1source"></div>
					</li>					
					<li>
						<div class="news2title"><a href="" target="_blank"></a></div>
						<div class="news2source"></div>
					</li>					
					<li>
						<div class="news3title"><a href="" target="_blank"></a></div>
						<div class="news3source"></div>
					</li>
					<li>
						<div class="news4title"><a href="" target="_blank"></a></div>
						<div class="news4source"></div>
					</li>
					<li>
						<div class="news5title"><a href="" target="_blank"></a></div>
						<div class="news5source"></div>
					</li>
				</ul>
				 <i class="fa fa-arrow-down" id="nt-example1-next"></i>
			</div>	 
		</div>	
		
		<div id="candidate_9" class="readytofight candidate_per" value="9">	
			<img id="image_9" class="personImg img-responsive center-block" src="" alt="" />			
			<div class="canName"></div>					
			<div class="canBrief"><a href="" target="_blank">維基百科</a></div>					
			<hr>
			<div class="news">
				<i class="fa fa-arrow-up" id="nt-example1-prev"></i>
	            <ul id="nt-example1">
					<li>
						<div class="news1title"><a href="" target="_blank"></a></div>
						<div class="news1source"></div>
					</li>					
					<li>
						<div class="news2title"><a href="" target="_blank"></a></div>
						<div class="news2source"></div>
					</li>					
					<li>
						<div class="news3title"><a href="" target="_blank"></a></div>
						<div class="news3source"></div>
					</li>
					<li>
						<div class="news4title"><a href="" target="_blank"></a></div>
						<div class="news4source"></div>
					</li>
					<li>
						<div class="news5title"><a href="" target="_blank"></a></div>
						<div class="news5source"></div>
					</li>
				</ul>
				 <i class="fa fa-arrow-down" id="nt-example1-next"></i>
			</div>	 
		</div>	
		
		<div id="candidate_10" class="readytofight candidate_per" value="10">	
			<img id="image_10" class="personImg img-responsive center-block" src="" alt="" />			
			<div class="canName"></div>					
			<div class="canBrief"><a href="" target="_blank">維基百科</a></div>					
			<hr>
			<div class="news">
				<i class="fa fa-arrow-up" id="nt-example1-prev"></i>
	            <ul id="nt-example1">
					<li>
						<div class="news1title"><a href="" target="_blank"></a></div>
						<div class="news1source"></div>
					</li>					
					<li>
						<div class="news2title"><a href="" target="_blank"></a></div>
						<div class="news2source"></div>
					</li>					
					<li>
						<div class="news3title"><a href="" target="_blank"></a></div>
						<div class="news3source"></div>
					</li>
					<li>
						<div class="news4title"><a href="" target="_blank"></a></div>
						<div class="news4source"></div>
					</li>
					<li>
						<div class="news5title"><a href="" target="_blank"></a></div>
						<div class="news5source"></div>
					</li>
				</ul>
				 <i class="fa fa-arrow-down" id="nt-example1-next"></i>
			</div>	 
		</div>	
		
		<div id="candidate_11" class="readytofight candidate_per" value="11">	
			<img id="image_11" class="personImg img-responsive center-block" src="" alt="" />			
			<div class="canName"></div>					
			<div class="canBrief"><a href="" target="_blank">維基百科</a></div>					
			<hr>
			<div class="news">
				<i class="fa fa-arrow-up" id="nt-example1-prev"></i>
	            <ul id="nt-example1">
					<li>
						<div class="news1title"><a href="" target="_blank"></a></div>
						<div class="news1source"></div>
					</li>					
					<li>
						<div class="news2title"><a href="" target="_blank"></a></div>
						<div class="news2source"></div>
					</li>					
					<li>
						<div class="news3title"><a href="" target="_blank"></a></div>
						<div class="news3source"></div>
					</li>
					<li>
						<div class="news4title"><a href="" target="_blank"></a></div>
						<div class="news4source"></div>
					</li>
					<li>
						<div class="news5title"><a href="" target="_blank"></a></div>
						<div class="news5source"></div>
					</li>
				</ul>
				 <i class="fa fa-arrow-down" id="nt-example1-next"></i>
			</div>
			<input type="hidden" name="id" value="" />
		</div>	
		
		
		
		<!--按鈕
		<img id="logo" src="image/logo.png" />-->
		<img class="vsBG" src="image/vsBG.png" />
		<div id="pkBtnLeft" class="pkBtn"></div>
		<div id="pkBtnRight" class="pkBtn"></div>
		
	</div>
	
	<div id="roundResult" style="display:none">
		<h1>你的勝出候選人是</h1><button class="shareResult btn btn-default">分享PK結果</button><button class="shareGame btn btn-default">分享此遊戲</button>
		<div class="roundResultBtn1 roundResultBtn">
				<p>看看還有那些候選人勝出？快登入Fb，一人一票，從他們之中選總統！</p>
				<button id="playAgain" class="btn btn-default">不滿意，再PK一次</button><!--他不是我要的(不滿意)b再PK(玩)一次-->
				<button id="goToVote" class="btn btn-default">登入Fb，投票去</button><!--就決定是他b投票去-->
		</div>
		<div class="roundResultBtn2 roundResultBtn">
				<!--<p>或是你想要，</p>
				讓更多人來玩吧-->
		</div>		
		
		<!--<div class="roundResultBtn">
				<p>遊戲進行到一半</p>
				<button id="playAgain" class="btn btn-default">不滿意，再PK一次</button>他不是我要的(不滿意)b再PK(玩)一次
				<button id="goToVote" class="btn btn-default">還不錯，繼續遊戲</button>就決定是他b投票去
				<button id="shareResult" class="btn btn-default">分享PK結果</button>讓更多人來玩吧
				<button id="shareGame" class="btn btn-default">分享此遊戲</button>
		</div>-->
	</div>
	
	<div id="VotePlace" style="display:none">
		<h1>經過比較與思考，我會在總統大選中將神聖的一票投給...</h1>
		<div id="finalResult" style="display:none">
			<p></p>
			<button class="shareResult btn btn-default">分享PK結果</button><!--讓更多人來玩吧-->
			<button class="shareGame btn btn-default">分享此遊戲</button>
			<button class="gotoindex btn btn-default">回首頁</button>
		</div>
		<button id="confirmToVote" type="button" class="btn btn-default">確認投票</button>
		<div id="candidateList" class="mainframe">
			<table id="voteTable">
				<tr>
					<td COLSPAN=4 align="center">PK戰勝出者</td>
				</tr>
			</table>
		</div>
		<div id="voteChart">
			<div id="hChart" style="width:670px;"></div>	
		</div>
	</div>
	<!--回首頁，再玩一次，分享遊戲-->
	<!---準備戰鬥，二選一PK戰，神聖投票所，完成-->
<script type="text/javascript" src="js/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="bootstrap/js/bootstrap.min.js"></script>
<script src="js/chart.js"></script>
<script src="js/prism.js"></script>
<!--<script src="js/jquery.mCustomScrollbar.min.js"></script>
<script src="js/jquery.newsTicker.js"></script>-->
<script type="text/javascript" src="alertifyjs/alertify.js"></script>
<script type="text/javascript" src="js/highcharts.js"></script>
<script type="text/javascript">
//觸發事件的function	
$(function(){

	//facebook
	window.fbAsyncInit = function(){
		FB.init({
			appId      : '1109820955698868',
			xfbml      : true,
			version    : 'v2.3'
		});
	};
	//載入sdk
	(function(d, s, id){
	var js, fjs = d.getElementsByTagName(s)[0];
	if (d.getElementById(id)) {return;}
	js = d.createElement(s); js.id = id;
	js.src = "//connect.facebook.net/en_US/sdk.js";
	fjs.parentNode.insertBefore(js, fjs);
	}(document, 'script', 'facebook-jssdk'));

	//選特質的功能
	var checkBox = $('input[name="personality"]');
	$(checkBox).on('click',function(event){
       	var clickoption = $(event.target);
		clickoption.parent().toggleClass("selected");
    });


	
	//按鈕
	$("#confirmPersonality").on('click', function(){

		$("#confirmPersonality").unbind('click');
		
		//加上按鈕功能
		$("#goToPlay").on('click', function(){
			$("#goToPlay").unbind();
			
			var animationend='webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
			$("#beforegame").addClass('animated zoomOut').one(animationend, function(){
				$(this).removeClass('animated zoomOut');
				$(this).css("display", "none");
				random();
			});
		});
		$("#validate").on('click', function(){
			$("#validate").unbind('click');
			nominateproperman();
		});
		
		
		//將輸入值塞入+格內
		if($(".othertext input").val()!=""){
			$("#otherBtn").prev().text($(".othertext input").val());
		}
		
		//動畫進出
		var animationend='webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
		$("#confirmPersonality").css("display", "none");
		$("#optiontext").addClass('animated bounceOutLeft').one(animationend, function(){
			$(this).css("display", "none");
			$(this).removeClass('animated bounceOutLeft');
			$("#nominatetext").css("display", "block");
			$("#nominatetext").addClass('animated fadeInLeft').one(animationend, function(){
				$(this).removeClass('animated fadeInLeft');
				$(".nominateBtn").css("display", "block");
			});
		});
		
	});
	$("#otherBtn").on('click', function(){
		if($(this).prop("checked")){
			var animationend='webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
			$(".othertext").css("display", "block");
			$(".othertext").addClass('animated fadeInRight').one(animationend, function(){
				$(this).removeClass('animated fadeInRight');
				$(".othertext").css("display", "block");
			});
		}
		else{
			var animationend='webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
			$(".othertext").addClass('animated bounceOutRight').one(animationend, function(){
				$(this).removeClass('animated bounceOutRight');
				$(".othertext").css("display", "none");
			});
		}
	});
});


//隨機選出10個候選人
function random(nominatedid){
	//產生初始值
	if(nominatedid==null) var numFight=9;
	else if(nominatedid!=null) var numFight=10;
	var winner_array=[];
	var loser_array=[];
	var URLs="random.php";
	$.ajax({
		url:URLs,
		data:{
			manid:nominatedid,
		},
		type:"POST",
		dataType:"json",
		success:function(json){
			for(var i=1; i<=10; i++){				
				$("#image_" + i).attr("src", "image/candidate/" + json.id[i] + '.' + json.type[i]);
				$("#candidate_" + i + " > .canName").text(json.name[i]);
				$("#candidate_" + i + " > .canBrief > a").attr("href", "https://zh.wikipedia.org/wiki/" + json.name[i]);
				$("#candidate_" + i + " > .canBrief").prepend(json.brief[i]);
				$("#candidate_" + i + " .news1title  a").html(json.title1[i]);
				$("#candidate_" + i + " .news1title  a").attr("href", json.link1[i]);
				//$("#candidate_" + i + " .news1abs").html(json.abs1[i]);
				$("#candidate_" + i + " .news1source").html(json.press1[i]);
				$("#candidate_" + i + " .news2title a").attr("href", json.link2[i]);
				$("#candidate_" + i + " .news2title a").html(json.title2[i]);
				//$("#candidate_" + i + " .news2abs").html(json.abs2[i]);
				$("#candidate_" + i + " .news2source").html(json.press2[i]);
				$("#candidate_" + i + " .news3title a").attr("href", json.link3[i]);
				$("#candidate_" + i + " .news3title a").html(json.title3[i]);
				//$("#candidate_" + i + " .news3abs").html(json.abs3[i]);
				$("#candidate_" + i + " .news3source").html(json.press3[i]);	
				$(".stepBar").attr("src", "image/step_2.jpg");
			}
			//在按鈕中加入初始值
			var can_id=json.id;
			if(nominatedid!=null) can_id[11]=$("#candidate_11 > input").val();
			
			console.log(json.name);
			console.log(can_id);
			$("#pkBtnLeft").on('click', function(e){
				choose($(".Left").attr('value'), 0, can_id, winner_array, loser_array ,numFight, 2);
			});
			$("#pkBtnRight").on('click', function(e){
				choose($(".Right").attr('value'), 0, can_id, winner_array, loser_array ,numFight, 2);
				//choose($(".Right").attr('value'), numFight-1, can_id, winner_array, loser_array ,numFight, 2);//測試用
			});
			
			$(".loading").css("display", "none");
			//alertify.notify( message, 'error', [wait, callback]);
			var animationend='webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
			$("#game").css("display", "block");
			$("#game").addClass('animated zoomIn').one(animationend, function(){
				$(this).removeClass('animated zoomIn');
			});
			var alerttext='<div style="font-family: cwTeXHei; font-size: 18px;">開始戰鬥</div>';
			alertify.set('notifier','position', 'top-right');
			alertify.notify(alerttext, 'custom', 5, function(){});			
		},
		beforeSend:function(){
			$(".loading").css("display", "block");
		},
		error: function(x, t, m) {
			if(t==="timeout") {
				$("#wait").empty();
				var alerttext='<div style="font-family: cwTeXHei; font-size: 18px;">認證時間過久，請稍後重新輸入</div>';
				alertify.set('notifier','position', 'top-right');
				alertify.notify(alerttext, 'custom', 5, function(){});
			} 
			else {
				alertify.error(t);
			}
		},
		complete:function(){

		}
	});
}

		

	
/*
function mouseoverimage(position){
	switch(position){
		case 'left':
			$("#image_left").addClass("animated bounce");
			$("#image_right").removeClass("animated bounce");
			break;
		case 'right':
			$("#image_right").addClass("animated bounce");
			$("#image_left").removeClass("animated bounce");
			break;
	}
}*/	
function isChn(string){
	var reg=/^[\u4e00-\u9fa5]+$/;
	if(!reg.test(string)){
		return false;  
    } 
    return true;  
}


function nominateproperman(man){
	
	$("#wait").html('認證中，請耐心等待...<img src="image/loading.gif" style="width:10%; height:10%;"/>');
	$("#nominatingText").empty();
	
	//先把submitNominate按鈕解除，亦可消除之前資訊
	$("#submitNominate").unbind();
	$("#nominateAction").css("display", "none");
	
	//阻擋空白，以及非中文字
	if(man==null) {
		var nominate=($("#nominate_name").val());
		if(nominate==""){
			$("#wait").empty();
			$("#validate").on('click', function(){
				nominateproperman();
			});
			return;
		}
		if (!isChn(nominate)){
			$("#wait").html("請輸入不含符號的中文姓名");
			$("#validate").on('click', function(){
				nominateproperman();
			});
			return;
		}
	}
	else var nominate=man;
	
	var request_url="nominate.php";	
	$.ajax({
		url:request_url,  
		data:{			 
			command:'NominatePreview',
			name:nominate,
		},
		type:"POST",
		timeout: 15000,
		dataType:"json",
		success:function(str){
			if(str.wiki==null) var string ='維基百科查無此人，馬上去為他建一個吧';
			else if(str.wiki=='Disambig') var string ='此名字是一個比較常見的中文人名，請輸入確切人名';
			else if(str.wiki=='names') {
				var string="";
				console.log(str[0]);
				for(var t=0; t<str[0].length; t++){
					string= string + '<button onclick="nominateproperman('+ "'" + str[0][t] + "'" +')">' + str[0][t] + '</button><br>';
				}
			}
			else if(str.wiki=='notHuman') var string ='這不是一個中文人名';
			else if(str.wiki=='deadMan') var string ='你以為你在玩陰屍路嗎？請找活人參戰';
			else{
				var string='<div>簡介：</div>'+
				'<div>' + str.wiki + '<a href="http://zh.wikipedia.org/zh-tw/' + str.wikiname+ '" target="_blank">維基百科</a></div>';
				
				$("#submitNominate").on('click', function(){
					//取消原按鈕功能
					$("#submitNominate").unbind();
					var animationend='webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
					$("#beforegame").addClass('animated zoomOut').one(animationend, function(){
						$(this).removeClass('animated zoomOut');
						$(this).css("display", "none");
						submitProperMan(str);
					});
				});
				$("#nominateAction").css("display", "block");
			}
			$("#wait").empty();
			$("#nominatingText").html(string);
		},
		beforeSend: function(){},
		error: function(x, t, m) {
			if(t==="timeout") {
				$("#wait").empty();
				var alerttext='<div style="font-family: cwTeXHei; font-size: 18px;">認證時間過久，請稍後重新輸入</div>';
				alertify.set('notifier','position', 'top-right');
				alertify.notify(alerttext, 'custom', 5, function(){});
			} 
			else {
				alertify.error(t);
			}
		},
		complete:function(){
			$("#validate").on('click', function(){
				nominateproperman();
			});
		}
	});
} 

function submitProperMan(jsondata){	
	//有參戰者之條件
	//傳入參戰者資料
	$("#candidate_11 > .canName").text(jsondata.name);
	$("#candidate_11 > .canBrief > a").attr("href", "https://zh.wikipedia.org/wiki/" + jsondata.wikiname);

	var URLs="nominate.php";
	var nominateId="";
	var checkused=true;
    $.ajax({
        url: URLs,
        data:{
			command:'NominateInsert',
			name:jsondata.name,
			wiki_name:jsondata.wikiname,
			brief:jsondata.wiki,			
		},
        type:"POST",
        dataType:'json',
        success: function(json){
			nominateId=json.id;
			checkused=json.used;
			if(checkused){
				var numNews=3;
				if(json.news==null)  numNews=0;
				else if(json.news.length<3 && json.news!=null) numNews=json.news.length;
				for (var x=1; x<=numNews; x++){
					$("#candidate_11 .news" + x + "title a").html(json.news[x].title);
					$("#candidate_11 .news" + x + "title a").attr("href", json.news[x].link);
					//$("#candidate_11 .news" + x + "abs").html(json.news[x].newsabtract);
					$("#candidate_11 .news" + x + "source").html(json.news[x].press);
				}
				$("#image_11").attr("src", "image/candidate/" + nominateId + '.' + json.type);
			}
			//將提名人的資料傳入
			$("#candidate_11 > input").val(json.id);
			$("#candidate_11 > .canBrief").prepend(json.brief);						
			random(json.id);
		},
        beforeSend:function(){
			$(".loading").css("display", "block");
		},
        complete:function(){
			if(!checkused){
				$.ajax({
					url:"nominate.php",
					data:{
						command:"NominateInsertSecond",
						wiki_name:jsondata.wikiname,
						man_id:nominateId,
					},
					type:"POST",
					dataType:'json',
					success: function(str){
						$("#image_11").attr("src", "image/candidate/" + nominateId + '.' + str.type);
						//將新聞資訊塞入
						var numNews=3;
						if(str.news==null)  numNews=0;
						else if(str.news.length<3 && str.news!=null) numNews=str.news.length;
						for (var x=1; x<=numNews; x++){
							$("#candidate_11 .news" + x + "title a").html(str.news[x].title);
							$("#candidate_11 .news" + x + "title a").attr("href", str.news[x].link);
							//$("#candidate_11 .news" + x + "abs").html(str.news[x].newsabtract);
							$("#candidate_11 .news" + x + "source").html(str.news[x].press);
						}
					},
				});
			}
		},
        error:function(){}
    });
}
	

function choose(winner, numberclick, candidate_id, winner_id, loser_id, fight_num, newcan_order){
	numberclick=numberclick+1;
	var leftside='Left';//左側戰鬥者類別
	var rightside='Right';//右側戰鬥者類別
	var left_order=$("." + leftside).attr('value');
	var right_order=$("." + rightside).attr('value');
	var winner_order=winner;
	if(winner_order==left_order){
		var loser_order=right_order;
		var loser_position=rightside;
		}
	else{
		var loser_order=left_order;
		var loser_position=leftside;
		}

	//點擊功能暫時失效
	$("#pkBtn" + leftside).unbind('click');
	$("#pkBtn" + rightside).unbind('click');
	//將對戰紀錄存入winner_id、loser_id
	winner_id[numberclick]=candidate_id[winner_order];
	loser_id[numberclick]=candidate_id[loser_order];
	
	console.log(winner_id);
	console.log(loser_id);
	//當對戰沒結束，呈現新的候選人
	if(numberclick<fight_num){
		console.log(numberclick);
		console.log(fight_num);
		//當有使用者提出的候選人時
		if(numberclick==9){
		//console.log("王牌");
			newcan_order=newcan_order+1;
			var animationend='webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
			var outanimation='animated bounceOut'+ loser_position;//出去的效果類別
			var inanimation='animated slideInDown';//進來的效果類別
			var special="animated flash";
			var nonfighter='readytofight';//非參與者類別
			$("#candidate_" + loser_order).addClass(outanimation).one(animationend, function(){
				$(this).removeClass(outanimation+ ' ' + loser_position);
				$(this).addClass(nonfighter);
			
				//更新
				$("#candidate_" + newcan_order).removeClass(nonfighter);
				$("#candidate_" + newcan_order).addClass(inanimation+ ' ' +　loser_position).one(animationend, function(){
					$(this).removeClass(inanimation);
					$(this).addClass(special).one(animationend, function(){
						$(this).removeClass(special);
						var alerttext='<div style="font-family: cwTeXHei; font-size: 18px;">經過一番激戰，最後與你心目中的王牌候選人較量!!</div>';
						alertify.set('notifier','position', 'top-right');
						alertify.notify(alerttext, 'custom', 5, function(){});
						//將click功能加上去
						$("#pkBtnLeft").on('click', function(){
						choose($(".Left").attr('value'), numberclick, candidate_id, winner_id, loser_id, fight_num, newcan_order);
						});
						$("#pkBtnRight").on('click', function(){
						choose($(".Right").attr('value'), numberclick, candidate_id, winner_id, loser_id, fight_num, newcan_order);
						});
					});
				});
			});
		}
		else{
			newcan_order=newcan_order+1;
			var animationend='webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
			var outanimation='animated bounceOut'+ loser_position;//出去的效果類別
			var inanimation='animated fadeIn' + loser_position;//進來的效果類別
			var nonfighter='readytofight';//非參與者類別
			//淘汰
			$("#candidate_" + loser_order).addClass(outanimation).one(animationend, function(){
				$(this).removeClass(outanimation+ ' ' + loser_position);
				$(this).addClass(nonfighter);
				//更新
				$("#candidate_" + newcan_order).removeClass(nonfighter);
				$("#candidate_" + newcan_order).addClass(inanimation+ ' ' +　loser_position).one(animationend, function(){
					$(this).removeClass(inanimation);
				
				//將click功能加上去
					$("#pkBtnLeft").on('click', function(){
						choose($(".Left").attr('value'), numberclick, candidate_id, winner_id, loser_id, fight_num, newcan_order);
					});
					$("#pkBtnRight").on('click', function(){
						choose($(".Right").attr('value'), numberclick, candidate_id, winner_id, loser_id, fight_num, newcan_order);
					});
				});
			});
		}
	}
	//當對戰結束時
	else{
		var animationend='webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
		$("#game").addClass('animated zoomOut').one(animationend, function(){
			$(this).css("display", "none");
			$(this).removeClass('animated zoomOut');

			console.log(numberclick);
			console.log(fight_num);
			console.log(collectPersonality());
			console.log(JSON.stringify(winner_id));
			//存入對戰紀錄，並顯示投票箱及分享框
			//var finalwinnerid=winner_id[fight_num];
			var request_url = "savefight.php";				
			$.ajax({
				url:request_url,  
				data:{
					winner_array:JSON.stringify(winner_id),
					loser_array:JSON.stringify(loser_id),
				},
				type:"POST",	
				dataType:"text",
				success:function(str){
					//console.log("yes存完了");
					finishGame(winner_order, winner_id[winner_id.length-1], str);
				},
				beforeSend:function(){
					$(".loading").css("display", "block");
				},
				async:true,
				error:function(){},
				complete:function(){}
			});
		});
	}
}
/*
function finishPersonality(){
	var opinion=collectPersonality();
	opinion = opinion + "你有沒有心目中的秘密人選想參戰?";
	$("#opinionN").html(opinion);
}*/

function collectPersonality(){
	var myopinion= new Array();
	for(var t=0; t<$('input[name="personality"]').length; t++){
		var listcanobj=$($('input[name="personality"]').get(t));
		if(listcanobj.prop("checked")){
			if(listcanobj.attr('value')=="other"){
				myopinion.push($(".othertext input").val());
			}
			else{
				myopinion.push(listcanobj.attr('value'));
			}
		}
	}
	if(myopinion.length!=0){
		var opinionString = myopinion[0];
		for(var t=1; t<myopinion.length; t++){
			opinionString= opinionString + '、' + myopinion[t];
		}
		opinionString="我認為一個理想的總統候選人應該具備「" + opinionString + "」的特質，他是...";
	}
	else{
		opinionString="";
	}
	return opinionString; 
}

function finishGame(roundwinner, roundWinnerId, roundWinnerImgname){
	//判斷狀態，塞入按鈕
	//ping("www.facebook.com.tw", function(e){
		if(typeof FB === "object"){
		//if(e == "responded" && typeof FB === "object"){
			//加入分享資訊
			var shareDescription=collectPersonality();
			shareDescription=encodeURIComponent(shareDescription);
			console.log("ping true");
			FB.getLoginStatus(function(response) {
			console.log(response.status);
				if (response.status === 'connected') {//第一次登入的人，未授權就會直接進入此階段?
					
					var uid = response.authResponse.userID;
					var accessToken = response.authResponse.accessToken;
					
					$(".shareGame").on('click', function(){
						//$("#shareGame").unbind();
						sharefb('http://www.votehome.com.tw/index.php', 'connected');
					});
					
					$(".shareResult").on('click', function(){
						//$("#shareResult").unbind();
						console.log('http://www.votehome.com.tw/index.php?des='+shareDescription+'&id='+roundWinnerId);
						sharefb('http://www.votehome.com.tw/index.php?des='+shareDescription+'&id='+roundWinnerId, 'connected');
					});
					$("#goToVote").on('click', function(){
						$("#goToVote").unbind();
						gotovotegame('connected');
					});	
				}	
				else if (response.status === 'not_authorized') {
					$(".shareGame").on('click', function(){
						//$("#shareGame").unbind();
						sharefb('http://www.votehome.com.tw/index.php', 'not_connected');
					});
					$(".shareResult").on('click', function(){
						//$("#shareResult").unbind();
						console.log('http://www.votehome.com.tw/index.php?des='+shareDescription+'&id='+roundWinnerId);
						sharefb('http://www.votehome.com.tw/index.php?des='+shareDescription+'&id='+roundWinnerId, 'not_connected');
					});
					$("#goToVote").on('click', function(){
						$("#goToVote").unbind();
						gotovotegame('not_connected');
					});	
				}
				else {
					$(".shareGame").on('click', function(){
						//$("#shareGame").unbind();
						sharefb('http://www.votehome.com.tw/index.php', 'not_connected');
					});
					$(".shareResult").on('click', function(){
						//$("#shareResult").unbind();
						console.log('http://www.votehome.com.tw/index.php?des='+shareDescription+'&id='+roundWinnerId);
						sharefb('http://www.votehome.com.tw/index.php?des='+shareDescription+'&id='+roundWinnerId, 'not_connected');
					});
					$("#goToVote").on('click', function(){
						$("#goToVote").unbind();
						gotovotegame('not_connected');
					});	
				}
				$(".loading").css("display", "none");
				var animationend='webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
				$("#roundResult").css("display", "block");
				$("#roundResult").addClass('animated zoomIn').one(animationend, function(){
					$(this).removeClass('animated zoomIn');
				});
			
			});
		}
		else{
			console.log("ping false");
			$(".shareGame").on('click', function(){
				//$("#shareGame").unbind();
				sharefb('http://www.votehome.com.tw/index.php', 'timeout');
			});
			$(".shareResult").on('click', function(){
				//$("#shareResult").unbind();
				console.log('http://www.votehome.com.tw/index.php?des='+shareDescription+'&id='+roundWinnerId);
				sharefb('http://www.votehome.com.tw/index.php?des='+shareDescription+'&id='+roundWinnerId, 'timeout');
			});
			$("#goToVote").on('click', function(){
				$("#goToVote").unbind();
				gotovotegame('timeout');
			});	
		}
	//});
	$("#playAgain").on('click', function(){
		$("#playAgain").unbind();
		location="fightgame.html";
	});
	
	$("#roundResult").append('<div class="optionform">' + $('.optionform').html()+ '</div>');
	$("#roundResult").append('<div class="final"><div class="personImg img-responsive center-block" style="background:url('+ $("#candidate_" + roundwinner + " > img").attr('src') +');background-size:auto 200px;background-repeat: no-repeat;background-position:center;"></div><div class="canName">' + $("#candidate_" + roundwinner + " > .canName").text() + '</div><div class="canBrief">' + $("#candidate_" + roundwinner + " > .canBrief").html() + '</div></div>');

	//加入按鈕
	/*$("#goToVote").on('click', function(){
		$("#goToVote").unbind();
		gotovotegame();
	});

		$(".shareResult").on('click', function(){
		//$("#shareResult").unbind();
		console.log('http://www.votehome.com.tw/index.php?des='+shareDescription+'&id='+roundWinnerId);
		sharefb('http://www.votehome.com.tw/index.php?des='+shareDescription+'&id='+roundWinnerId);
	});

	$(".shareGame").on('click', function(){
		//$("#shareGame").unbind();
		sharefb('http://www.votehome.com.tw/index.php');
	});*/

}
function ping(ip, callback) {

    if (!this.inUse) {
        this.status = 'unchecked';
        this.inUse = true;
        this.callback = callback;
        this.ip = ip;
        var _that = this;
        this.img = new Image();
        this.img.onload = function () {
            _that.inUse = false;
            _that.callback('responded');

        };
        this.img.onerror = function (e) {
            if (_that.inUse) {
                _that.inUse = false;
                _that.callback('responded', e);
            }

        };
        this.start = new Date().getTime();
        this.img.src = "http://" + ip;
        this.timer = setTimeout(function () {
            if (_that.inUse) {
                _that.inUse = false;
                _that.callback('timeout');
            }
        }, 5000);
    }
}


function gotovotegame(status){
	var animationend='webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
	$("#roundResult").addClass('animated zoomOut').one(animationend, function(){
		$(this).css("display", "none");
		$(this).removeClass('animated zoomOut');
		$(".loading").css("display", "block");
		if(status=="connected"){
		//	var uid = response.authResponse.userID;
		//	var accessToken = response.authResponse.accessToken;
			loadWithFbApi();
						
			//加入按鈕
			$("#confirmToVote").on('click', function(){
				$("#confirmToVote").unbind();
				$("#confirmToVote").css("display", "none");
				var animationend='webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
				$("#candidateList").addClass('animated bounceOutLeft').one(animationend, function(){
					$(this).css("display", "none");
					$(this).removeClass('animated bounceOutLeft');
					vote();
				});	
			});	
		}
		else if(status=="not_connected"){
			fblogin();
		}
		else if(status=="timeout"){
			var alerttext='<div style="font-family: cwTeXHei; font-size: 18px;">與Facebook伺服器連線失敗，請確認網路狀態</div>';
			alertify.set('notifier','position', 'top-right');
			alertify.notify(alerttext, 'custom', 0, function(){});
		}
		/*
		ping("www.facebook.com.tw", function(e){
			if(e == "responded" && typeof FB === "object"){
				FB.getLoginStatus(function(response) {
					//alert(response.status);
					if (response.status === 'connected') {//第一次登入的人，未授權就會直接進入此階段?
						var uid = response.authResponse.userID;
						var accessToken = response.authResponse.accessToken;
						loadWithFbApi();
						
						//加入按鈕
						$("#confirmToVote").on('click', function(){
							$("#confirmToVote").unbind();
							$("#confirmToVote").css("display", "none");
							var animationend='webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
							$("#candidateList").addClass('animated bounceOutLeft').one(animationend, function(){
								$(this).css("display", "none");
								$(this).removeClass('animated bounceOutLeft');
								vote();
							});	
						});	
					} 
					else if (response.status === 'not_authorized') {
						console.log("第一次已經登入，但是沒授權");
						fblogin();
					} 
					else {
						console.log("第一次未登入");
						fblogin();
					}
				});
			}
			else{
				var alerttext='<div style="font-family: cwTeXHei; font-size: 18px;">與Facebook伺服器連線失敗，請確認網路狀態</div>';
				alertify.set('notifier','position', 'top-right');
				alertify.notify(alerttext, 'custom', 0, function(){});
			}
		});*/
	});
}
function fblogin(){
	FB.login(function(response) {
			if (response.status === 'connected') {//第一次登入的人，未授權就會直接進入此階段?
				var uid = response.authResponse.userID;
				var accessToken = response.authResponse.accessToken;
				loadWithFbApi();
				//加入按鈕
				$("#confirmToVote").on('click', function(){
					$("#confirmToVote").unbind();
					$("#confirmToVote").css("display", "none");
					var animationend='webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
					$("#candidateList").addClass('animated bounceOutLeft').one(animationend, function(){
						$(this).css("display", "none");
						$(this).removeClass('animated bounceOutLeft');
						vote();
					});	
				});				
			} 
			else if (response.status === 'not_authorized') {
				console.log("原本沒登入，後來登入，但是仍未授權");
				var alerttext='<div style="font-family: cwTeXHei; font-size: 18px;">Facebook登入失敗，請重新整理頁面</div>';
				alertify.set('notifier','position', 'top-right');
				alertify.notify(alerttext, 'custom', 0, function(){});
			} 
			else {
				console.log("仍然不想登入");
				var alerttext='<div style="font-family: cwTeXHei; font-size: 18px;">Facebook登入失敗，請重新整理頁面</div>';
				alertify.set('notifier','position', 'top-right');
				alertify.notify(alerttext, 'custom', 0, function(){});
			}
	}, {scope:"public_profile,email, user_friends"});
}
function loadWithFbApi(){
	FB.api("/me?fields=id,email,first_name,last_name,name,link,gender,friends,verified,timezone,updated_time", 
	function(response) {
		console.log(response);
		if(response && !response.error){
			responsedata=JSON.stringify(response);
			//console.log(response);
			var request_url='login.php';
			$.ajax({
				url:request_url,  
				data:{
					userdata:responsedata,
				},
				type:"POST",	
				dataType:"json",
				success:function(json){
					console.log(json);
					if(json.status=="login"){
						//載入highcharts表單
						$("#hChart").css("height", json.height + "px");
						hcharts(json.canname, json.ballotnumber);
						
						//載入list
						var string="";
						if(json.include) var friendbeg=0;
						else var friendbeg=1;
						for(var i=0; i<json.name.length; i++){
							//console.log(friendbeg);
							//console.log(json.numberFriendsBest);
							if(i>=friendbeg && i<friendbeg+json.numberFriendsBest){
								if(json.id[i]==json.myBest)	{
									string =string + '<tr>' +
													'<td><label><span>朋友<br>投了</span><div><input type="checkbox" name="list" value="' + json.name[i] + '" style="display:none;" checked/></div></label></td>' + 
													'<td><img src="image/candiate.png" /></td>' +
													'<td><a href="https://zh.wikipedia.org/wiki/'+ json.name[i] +'" target="_blank">' + json.name[i] +'</a></td>' +
													'</tr>';
								}
								else{
									string =string + '<tr>' +
													'<td><label><span>朋友<br>投了</span><div><input type="checkbox" name="list" value="' + json.name[i] + '" style="display:none;"/></div></label></td>' + 
													'<td><img src="image/candiate.png" /></td>' +
													'<td><a href="https://zh.wikipedia.org/wiki/'+ json.name[i] +'" target="_blank">' + json.name[i] +'</a></td>' +
													'</tr>';
								}
							}
							else{
								if(json.id[i]==json.myBest)	{ 
									string =string + '<tr>' +
													'<td><label><div><input type="checkbox" name="list" value="' + json.name[i] + '" style="display:none;" checked/></div></label></td>' + 
													'<td><img src="image/candiate.png" /></td>' +
													'<td><a href="https://zh.wikipedia.org/wiki/'+ json.name[i] +'" target="_blank">' + json.name[i] +'</a></td>' +
													'</tr>';
								}
								else{
									string =string + '<tr>' +
													'<td><label><div><input type="checkbox" name="list" value="' + json.name[i] + '" style="display:none;"/></div></label></td>' + 
													'<td><img src="image/candiate.png" /></td>' +
													'<td><a href="https://zh.wikipedia.org/wiki/'+ json.name[i] +'" target="_blank">' + json.name[i] +'</a></td>' +
													'</tr>';
								}
							}
						}
						$("#voteTable").append(string);
						singleSelect();
						
						//畫面飛入
						$(".stepBar").attr("src", "image/step_3.jpg");
						$(".loading").css("display", "none");
						var animationend='webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
						$("#VotePlace").css("display", "block");
						$("#VotePlace").addClass('animated zoomIn').one(animationend, function(){
							$(this).removeClass('animated zoomIn');
						});

					}
					else if(json.status=="logout"){
						logoutredirect();
					}
				},
				async:false,
				error:function(xhr, status, errorThrown){
					//alert("Sorry, there was a problem!");
					console.log("Error: " + errorThrown);
					console.log("Status: " + status);
					console.dir( xhr );
				},
				beforeSend:function(){},
				complete:function(){}
			});
		}
		else{
		//未寫
		}
	});
}

		
		
	/*var checkBox = $('input[name="list"]');
	$(checkBox).on('click',function(event){
       	var clickoption = $(event.target);
		clickoption.parent().toggleClass("selected");
		customCheckbox();
    });*/
//投票去
function singleSelect(){
	for(var t=0; t<$('input:checkbox[name="list"]').length; t++){
		var listcanobj=$($('input:checkbox[name="list"]').get(t));
		if(listcanobj.prop("checked")){
			listcanobj.parent().addClass("selected");
		}
	}
	
	$('input:checkbox[name="list"]').on('click', function(event) {
		//event.stopPropagation();
		//event.preventDefault();
		var $box = $(event.target);
		if ($box.prop("checked")) {
			var group = 'input:checkbox[name="list"]';
			$(group).prop("checked", false);
			$(group).parent().removeClass("selected");
			$box.prop("checked", true);
			$box.parent().addClass("selected");
		} 
		else {
			$box.prop("checked", false);
			$box.parent().removeClass("selected");
		}
	});
}

function vote(){
	var voteone="";
	for(var t=0; t<$('input:checkbox[name="list"]').length; t++){
		var listcanobj=$($('input:checkbox[name="list"]').get(t));
		if(listcanobj.prop("checked")){
			voteone=listcanobj.val();
		}
	}

	var request_url="vote.php"
	$.ajax({
		url:request_url,
		data:{
			bestname:voteone,
		},
		type:"POST",
		dataType:"json",
		success:function(json){
			if(json.status=="login"){
				$("#hChart").css("height", json.height + "px");
				hcharts(json.canname, json.ballotnumber);
				$(".stepBar").attr("src", "image/step_4.jpg");
				
				//動畫部分
				$("#finalResult > p").text(voteone);
				$("#finalResult").css("display", "block")
				
				//加入按鈕
				$(".gotoindex").on('click', function(){
					location="index.php";
				});
			}
			else if(json.status=="logout"){
				logoutredirect();
			}
		},
		complete:function(){
		}
	});
}
function fblogintoshare(sharelink){
	FB.login(function(response) {
			if (response.status === 'connected') {//第一次登入的人，未授權就會直接進入此階段?
				FB.ui({
				method: 'share',
				href: sharelink
				},
				function(response){
					//console.log(response);
				}
				);
				$(".shareGame").unbind();
				$(".shareGame").on('click', function(){
					sharefb('http://www.votehome.com.tw/index.php', 'connected');
				});
			} 
			else if (response.status === 'not_authorized') {
				console.log("原本沒登入，後來登入，但是仍未授權");
			} 
			else {
				console.log("仍然不想登入");
			}
	}, {scope:"public_profile,email, user_friends"});
}
function sharefb(link, status){
	console.log(status);
	if(status=="connected"){
		FB.ui({
			method: 'share',
			href: link
			},
			function(response){
				//console.log(response);
			}
		);
	}
	else if(status=="not_connected"){
		console.log("open login window");
		fblogintoshare(link);
	}
	else if(status=="timeout"){
		var alerttext='<div style="font-family: cwTeXHei; font-size: 18px;">與Facebook伺服器連線失敗，請確認網路狀態</div>';
		alertify.set('notifier','position', 'top-right');
		alertify.notify(alerttext, 'custom', 0, function(){});
	}

	/*
	ping("www.facebook.com.tw", function(e){
	if(e == "responded" && typeof FB === "object"){
		FB.getLoginStatus(function(response) {
			//alert(response.status);
			if (response.status === 'connected') {//第一次登入的人，未授權就會直接進入此階段?
				FB.ui({
				method: 'share',
				href: link
				},
				function(response){
					//console.log(response);
				}
				);
			} 
			else if (response.status === 'not_authorized') {
				console.log("第一次已經登入，但是沒授權");
				fblogintoshare();
			} 
			else {
				console.log("第一次未登入");
				fblogintoshare();
			}
		});
	}
	else{
		var alerttext='<div style="font-family: cwTeXHei; font-size: 18px;">與Facebook伺服器連線失敗，請確認網路狀態</div>';
		alertify.set('notifier','position', 'top-right');
		alertify.notify(alerttext, 'custom', 0, function(){});
	}
	});*/
}
function logoutredirect(){
	var alerttext='<div style="font-family: cwTeXHei; font-size: 18px;">閒置過久，請重新遊戲</div>';
	alertify.set('notifier','position', 'top-right');
	alertify.notify(alerttext, 'custom', 2, function(){});
	setTimeout(function(){
		location="fightgame.html";
	},2000); 
}

function hcharts(xdata, ydata) {
    $('#hChart').highcharts({
        chart: {
            type: 'bar'
        },
        title: {
            text: '',
        },
        xAxis: {
            categories: xdata,
			labels:{
				style:{font: '14px futura, cwTeXHei, serif'}
			}
		},
        yAxis: {
			allowDecimals: false,
            min: 0,
            title: {
                text: '票數',
				style:{font: '14px futura, cwTeXHei, serif'}
            }
        },
        legend: {
            reversed: true
        },
		plotOptions: {
            series: {
				stacking: 'normal',
                cursor: 'pointer',
                point: {
                    events: {
                        click: function () {
                            window.open('https://zh.wikipedia.org/wiki/' + this.category);
                        },
                    }
                }
            }
        },
        series: [{
			//allowPointSelect: true,
            name: 'Facebook有效選舉人數',
            data: ydata,
			//color: '#00FF00',
        }]
    });
}





		

//define a new dialog
if(!alertify.myAlert){
  alertify.dialog('myAlert',function(){
    return{
      main:function(message){
        this.message = message;
      },
      setup:function(){
          return { 
            buttons:[{text: "cool!", key:27/*Esc*/}],
            focus: { element:0 }
          };
      },
      prepare:function(){
        this.setContent(this.message);
      }
  }});
}
/*			   //把選秀名單都載入，若無人選?
function loadMyList(){
	var string="<div>pk戰勝利的優勝者們</div>";
	var request_url="list.php";
	$.ajax({
		url:request_url,
		type:"POST",
		dataType:"json",
		success:function(json){
			//console.log(json);
			if(json.include) var friendbeg=0;
			else var friendbeg=1;
			for(var i=0; i<json.name.length; i++){
				//console.log(friendbeg);
				//console.log(json.numberFriendsBest);
				if(i>=friendbeg && i<friendbeg+json.numberFriendsBest){
					if(json.id[i]==json.myBest) string =string + '<div><input type="checkbox" name="list" value="'+  json.name[i] +'" checked /><b>'+ json.name[i] +'</b></div>';
					else string =string + '<div><input type="checkbox" name="list" value="'+  json.name[i] +'" /><b>'+ json.name[i] +'</b></div>';
				}
				else{
					if(json.id[i]==json.myBest) string =string + '<div><input type="checkbox" name="list" value="'+  json.name[i] +'" checked />'+ json.name[i] +'</div>';
					else string =string + '<div><input type="checkbox" name="list" value="'+  json.name[i] +'" />'+ json.name[i] +'</div>';
				}
			}
			$("#candidateList").append(string);
			singleSelect();
		},
		asyns:true,
		complete:function(){			
			//$("body").css("display", "block");
			loadAllList();
		},
		error:function(xhr, status, errorThrown){
				//alert("Sorry, there was a problem!");
				console.log("Error: " + errorThrown);
				console.log("Status: " + status);
				console.dir( xhr );
			}
	});
}
//console.log($("#list > input").length);




function loadAllList(){
	var request_url="loadalllist.php"
	$.ajax({
		url:request_url,
		type:"POST",
		dataType:"json",
		success:function(json){
			//console.log(json.name);
			//console.log(json.number);
			//echart(json.name.reverse(), json.number.reverse());
			$("#hChart").css("height", json.height + "px");
			hcharts(json.name, json.number);
		},
		asyns:true,
		complete:function(){
		}
	});		
}

function checkmybox(fwinnerid){
			$('#favotite_one').unbind('click');
			$('#favorite_one').unbind('mouseover');
			$('#favorite_two').unbind('click');
			$('#favorite_two').unbind('mouseover');
			$('#favorite_three').unbind('click');
			$('#favorite_three').unbind('mouseover');
			var request_url = "mybox.php";
			$.ajax({
			url:request_url,  
			data:{
				action:'check',
				user:user_id,
				fwinner:fwinnerid
			},
			type:"POST",	
			dataType:"text",
			success:function(str){
			if(str=='qualified'){
				var animationend='webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
				$('#favorite_one').on('mouseover', function(){
				$(this).addClass('animated bounce').one(animationend,function(){
				$(this).removeClass('animated bounce');
				});
				});
				$('#favorite_one').on('click', function(){
				updatemybox($(this).attr('value'));
				});
				$('#favorite_two').on('mouseover', function(){
				$(this).addClass('animated bounce').one(animationend,function(){
				$(this).removeClass('animated bounce');
				});
				});
				$('#favorite_two').on('click', function(){
				updatemybox($(this).attr('value'));
				});
				$('#favorite_three').on('mouseover', function(){
				$(this).addClass('animated bounce').one(animationend,function(){
				$(this).removeClass('animated bounce');
				});
				});
				$('#favorite_three').on('click', function(){
				updatemybox($(this).attr('value'));
				});
				}
			},
			async:true,
			error:function(){},
			complete:function(){}
			});	
		}
function loadmybox(){
		var request_url = "mybox.php";				
		$.ajax({
			url:request_url,  
			data:{
				action:'load',
				user:user_id
			},
			type:"POST",	
			dataType:"json",
			success:function(str){
			if (str[1]!=null) $("#favorite_one").attr('src', str[1]);
			if (str[2]!=null) $("#favorite_two").attr('src', str[2]);
			if (str[3]!=null) $("#favorite_three").attr('src', str[3]);
			},
			async:true,
			error:function(){},
			beforeSend:function(){},
			complete:function(){}
			});
}
function updatemybox(position){
		$('#favotite_one').unbind('click');
		$('#favorite_one').unbind('mouseover');
		$('#favorite_two').unbind('click');
		$('#favorite_two').unbind('mouseover');
		$('#favorite_three').unbind('click');
		$('#favorite_three').unbind('mouseover');
		var finalwinnerid=winner_id[fight_num];
		var request_url = "myfavorite.php";				
		$.ajax({
			url:request_url,
			data:{
				action:'update',
				fwinner:finalwinnerid,
				personposition:position,
				user:user_id
			},
			type:"POST",	
			dataType:"text",
			success:function(str){
			//checkmybox(finalwinnerid);
			loadmybox();
			},
			async:true,
			error:function(){},
			complete:function(){}
			});
		}*/
</script>
</body>
</html>