<!DOCTYPE html>
<html>
<head>    
<meta charset="utf-8">    
<title>2016超級總統生死鬥</title>	
<link  rel="stylesheet" href="bootstrap/css/bootstrap.min.css" type="text/css" media="screen" charset="utf-8" />
<link  rel="stylesheet" href="css/animate.css" type="text/css" media="screen" charset="utf-8" />
<link  rel="stylesheet" href="alertifyjs/css/alertify.css" type="text/css" media="screen" charset="utf-8" />
<link  rel="stylesheet" href="css/fightgame.css" type="text/css" media="screen" charset="utf-8" />
</head>

<body style="display:none">
		<div class="row "><h1 class="headertext2 text-center">2016超級總統生死鬥-先戰鬥後補票</h1></div>
		<div class="row "><h2 class="headertext2 text-center">候選人PK戰</h2></div>
		<div class="row rowline"></div>	
		
	<div id="personality_option" class="container">
	  <div><h2>你認為好的總統候選人應該具備什麼特質？</h2></div>
		<div>
			<label class="listcheckbox">
				<input type="checkbox" name="personality" value="王室血統"/>
				<div id="" class="checkArea"></div>
			</label>
			<div>王室血統</div>
		</div>
		<div>
			<label class="listcheckbox">
				<input type="checkbox" name="personality" value="一表人才"/>
				<div id="" class="checkArea"></div>
			</label>
			<div>一表人才</div>
		</div>
		<div>
			<label class="listcheckbox">
				<input type="checkbox" name="personality" value="清廉"/>
				<div id="" class="checkArea"></div>
			</label>
			<div>清廉</div>
		</div>
		<div>
			<label class="listcheckbox">
				<input type="checkbox" name="personality" value="學富五車有內涵"/>
				<div id="" class="checkArea"></div>
			</label>
			<div>學富五車有內涵</div>
		</div>
		<div>
			<label class="listcheckbox">
				<input type="checkbox" name="personality" value="不容易流淚"/>
				<div id="" class="checkArea"></div>
			</label>
			<div>不容易流淚</div>
		</div>
		<div>
			<label class="listcheckbox">
				<input type="checkbox" name="personality" value="體恤民意"/>
				<div id="" class="checkArea"></div>
			</label>
			<div>體恤民意</div>
		</div>
		<div>
			<label class="listcheckbox">
				<input type="checkbox" name="personality" value="兩岸政策"/>
				<div id="" class="checkArea"></div>
			</label>
			<div>兩岸政策</div>
		</div>
		<div>
			<label class="listcheckbox">
				<input type="checkbox" name="personality" value="台灣主體性"/>
				<div id="" class="checkArea"></div>
			</label>
			<div>台灣主體性</div>
		</div>
		<div>
			<label class="listcheckbox">
				<input type="checkbox" name="personality" value="勤勞踏實"/>
				<div id="" class="checkArea"></div>
			</label>
			<div>勤勞踏實</div>
		</div>
		<div>
			<label class="listcheckbox">
				<input type="checkbox" name="personality" value="未來擘畫"/>
				<div id="" class="checkArea"></div>
			</label>
			<div>未來擘畫</div>
		</div>
		<div>
			<label class="listcheckbox">
				<input type="checkbox" name="personality" value="領導魅力"/>
				<div id="" class="checkArea"></div>
			</label>
			<div>領導魅力</div>
		</div>
		<div>
			<label class="listcheckbox">
				<input type="checkbox" name="personality" value="協調能力"/>
				<div id="" class="checkArea"></div>
			</label>
			<div>協調能力</div>
		</div>
		<button id="confirmPersonality" type="button" class="btn btn-default">確認</button>
	</div>
	
	<div id="nominateProperOne" class="container" style="display:none">
		<div id="opinionN"></div>
		<button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">有，邀請他加入戰局</button>
		<button id="goToPlay" type="button" class="btn btn-default">沒有，開始PK</button>
		
		<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
		  <div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					<h4 class="modal-title" id="myModalLabel">我心目中的秘密人選</h4>
				</div>
				<div class="modal-body">
					<span>姓名：</span>
					<input id="nominate_name" type="text" name="newname" size=20 value="" />
					<div id="validate" type="button" class="btn btn-default">認證</div>
					<span id="wait"></span>
					
					<div id="nominate_img"></div>
					<div id="nominatetext"></div>
				</div>
				<div class="modal-footer">
					<div id="nominateAction" style="display:none">
					<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
					<button id="submitNominate" type="button" class="btn btn-default" data-dismiss="modal">確認</button>
					</div>
				</div>
			</div>
		  </div>
	    </div>
	</div>



	<div id="game" class="container" style="display:none">
	
		<div id="candidate_1" class="left col-md-5 candidate_per" value="1">			
			<a id="image_1" href="#"><img class="person_img img-responsive center-block" src="" alt=""></a>
			<hr class="hrline">				
			<div class="canName"></div>					
			<div class="canBrief" style="height:107px; overflow:hidden;"></div>
			<a class="canWikiLink" href="" target="_blank">維基百科</a>					
			<div>
				<div class="news1title"><a href="" target="_blank"></a></div>
				<div class="news1abs"></div>
				<div class="news1source"></div>
			</div>					
			<div>
				<div class="news2title"><a href="" target="_blank"></a></div>
				<div class="news2abs"></div>
				<div class="news2source"></div>
			</div>					
			<div>
				<div class="news3title"><a href="" target="_blank"></a></div>
				<div class="news3abs"></div>
				<div class="news3source"></div>
			</div>                    					
		</div>		
		<!--
		<div class="col-md-2">
		<h1 class="text-center vsh1">vs</h1>
		</div>
		-->
		<div id="candidate_2" class="right col-md-5 candidate_per" value="2">			
			<a id="image_2" href="#"><img class="person_img img-responsive center-block" src="" alt=""></a>
			<hr class="hrline">				
			<div class="canName"></div>					
			<div class="canBrief" style="height:107px; overflow:hidden;"></div>
			<a class="canWikiLink" href="" target="_blank">維基百科</a>					
			<div>
				<div class="news1title"><a href="" target="_blank"></a></div>
				<div class="news1abs"></div>
				<div class="news1source"></div>
			</div>					
			<div>
				<div class="news2title"><a href="" target="_blank"></a></div>
				<div class="news2abs"></div>
				<div class="news2source"></div>
			</div>					
			<div>
				<div class="news3title"><a href="" target="_blank"></a></div>
				<div class="news3abs"></div>
				<div class="news3source"></div>
			</div>                    					
		</div>
		
		<div id="candidate_3" class="readytofight col-md-5 candidate_per" value="3">			
			<a id="image_3" href="#"><img class="person_img img-responsive center-block" src="" alt=""></a>
			<hr class="hrline">				
			<div class="canName"></div>					
			<div class="canBrief" style="height:107px; overflow:hidden;"></div>
			<a class="canWikiLink" href="" target="_blank">維基百科</a>					
			<div>
				<div class="news1title"><a href="" target="_blank"></a></div>
				<div class="news1abs"></div>
				<div class="news1source"></div>
			</div>					
			<div>
				<div class="news2title"><a href="" target="_blank"></a></div>
				<div class="news2abs"></div>
				<div class="news2source"></div>
			</div>					
			<div>
				<div class="news3title"><a href="" target="_blank"></a></div>
				<div class="news3abs"></div>
				<div class="news3source"></div>
			</div>                    					
		</div>
		
		<div id="candidate_4" class="readytofight col-md-5 candidate_per" value="4">			
			<a id="image_4" href="#"><img class="person_img img-responsive center-block" src="" alt=""></a>
			<hr class="hrline">				
			<div class="canName"></div>					
			<div class="canBrief" style="height:107px; overflow:hidden;"></div>
			<a class="canWikiLink" href="" target="_blank">維基百科</a>					
			<div>
				<div class="news1title"><a href="" target="_blank"></a></div>
				<div class="news1abs"></div>
				<div class="news1source"></div>
			</div>					
			<div>
				<div class="news2title"><a href="" target="_blank"></a></div>
				<div class="news2abs"></div>
				<div class="news2source"></div>
			</div>					
			<div>
				<div class="news3title"><a href="" target="_blank"></a></div>
				<div class="news3abs"></div>
				<div class="news3source"></div>
			</div>                    					
		</div>	

		<div id="candidate_5" class="readytofight col-md-5 candidate_per" value="5">			
			<a id="image_5" href="#"><img class="person_img img-responsive center-block" src="" alt=""></a>
			<hr class="hrline">				
			<div class="canName"></div>					
			<div class="canBrief" style="height:107px; overflow:hidden;"></div>
			<a class="canWikiLink" href="" target="_blank">維基百科</a>					
			<div>
				<div class="news1title"><a href="" target="_blank"></a></div>
				<div class="news1abs"></div>
				<div class="news1source"></div>
			</div>					
			<div>
				<div class="news2title"><a href="" target="_blank"></a></div>
				<div class="news2abs"></div>
				<div class="news2source"></div>
			</div>					
			<div>
				<div class="news3title"><a href="" target="_blank"></a></div>
				<div class="news3abs"></div>
				<div class="news3source"></div>
			</div>                    					
		</div>	
		
		<div id="candidate_6" class="readytofight col-md-5 candidate_per" value="6">			
			<a id="image_6" href="#"><img class="person_img img-responsive center-block" src="" alt=""></a>
			<hr class="hrline">				
			<div class="canName"></div>					
			<div class="canBrief" style="height:107px; overflow:hidden;"></div>
			<a class="canWikiLink" href="" target="_blank">維基百科</a>					
			<div>
				<div class="news1title"><a href="" target="_blank"></a></div>
				<div class="news1abs"></div>
				<div class="news1source"></div>
			</div>					
			<div>
				<div class="news2title"><a href="" target="_blank"></a></div>
				<div class="news2abs"></div>
				<div class="news2source"></div>
			</div>					
			<div>
				<div class="news3title"><a href="" target="_blank"></a></div>
				<div class="news3abs"></div>
				<div class="news3source"></div>
			</div>                    					
		</div>	
		
		<div id="candidate_7" class="readytofight col-md-5 candidate_per" value="7">			
			<a id="image_7" href="#"><img class="person_img img-responsive center-block" src="" alt=""></a>
			<hr class="hrline">				
			<div class="canName"></div>					
			<div class="canBrief" style="height:107px; overflow:hidden;"></div>
			<a class="canWikiLink" href="" target="_blank">維基百科</a>					
			<div>
				<div class="news1title"><a href="" target="_blank"></a></div>
				<div class="news1abs"></div>
				<div class="news1source"></div>
			</div>					
			<div>
				<div class="news2title"><a href="" target="_blank"></a></div>
				<div class="news2abs"></div>
				<div class="news2source"></div>
			</div>					
			<div>
				<div class="news3title"><a href="" target="_blank"></a></div>
				<div class="news3abs"></div>
				<div class="news3source"></div>
			</div>                    					
		</div>	
		
		<div id="candidate_8" class="readytofight col-md-5 candidate_per" value="8">			
			<a id="image_8" href="#"><img class="person_img img-responsive center-block" src="" alt=""></a>
			<hr class="hrline">				
			<div class="canName"></div>					
			<div class="canBrief" style="height:107px; overflow:hidden;"></div>
			<a class="canWikiLink" href="" target="_blank">維基百科</a>					
			<div>
				<div class="news1title"><a href="" target="_blank"></a></div>
				<div class="news1abs"></div>
				<div class="news1source"></div>
			</div>					
			<div>
				<div class="news2title"><a href="" target="_blank"></a></div>
				<div class="news2abs"></div>
				<div class="news2source"></div>
			</div>					
			<div>
				<div class="news3title"><a href="" target="_blank"></a></div>
				<div class="news3abs"></div>
				<div class="news3source"></div>
			</div>                    					
		</div>	
		
		<div id="candidate_9" class="readytofight col-md-5 candidate_per" value="9">			
			<a id="image_9" href="#"><img class="person_img img-responsive center-block" src="" alt=""></a>
			<hr class="hrline">				
			<div class="canName"></div>					
			<div class="canBrief" style="height:107px; overflow:hidden;"></div>
			<a class="canWikiLink" href="" target="_blank">維基百科</a>					
			<div>
				<div class="news1title"><a href="" target="_blank"></a></div>
				<div class="news1abs"></div>
				<div class="news1source"></div>
			</div>					
			<div>
				<div class="news2title"><a href="" target="_blank"></a></div>
				<div class="news2abs"></div>
				<div class="news2source"></div>
			</div>					
			<div>
				<div class="news3title"><a href="" target="_blank"></a></div>
				<div class="news3abs"></div>
				<div class="news3source"></div>
			</div>                    					
		</div>	
		
		<div id="candidate_10" class="readytofight col-md-5 candidate_per" value="10">			
			<a id="image_10" href="#"><img class="person_img img-responsive center-block" src="" alt=""></a>
			<hr class="hrline">				
			<div class="canName"></div>					
			<div class="canBrief" style="height:107px; overflow:hidden;"></div>
			<a class="canWikiLink" href="" target="_blank">維基百科</a>					
			<div>
				<div class="news1title"><a href="" target="_blank"></a></div>
				<div class="news1abs"></div>
				<div class="news1source"></div>
			</div>					
			<div>
				<div class="news2title"><a href="" target="_blank"></a></div>
				<div class="news2abs"></div>
				<div class="news2source"></div>
			</div>					
			<div>
				<div class="news3title"><a href="" target="_blank"></a></div>
				<div class="news3abs"></div>
				<div class="news3source"></div>
			</div>                    					
		</div>	
		
		<div id="candidate_11" class="readytofight col-md-5 candidate_per" value="11">			
			<a id="image_11" href="#"><img class="person_img img-responsive center-block" src="" alt=""></a>
			<hr class="hrline">				
			<div class="canName"></div>					
			<div class="canBrief" style="height:107px; overflow:hidden;"></div>
			<a class="canWikiLink" href="" target="_blank">維基百科</a>					
			<div>
				<div class="news1title"><a href="" target="_blank"></a></div>
				<div class="news1abs"></div>
				<div class="news1source"></div>
			</div>					
			<div>
				<div class="news2title"><a href="" target="_blank"></a></div>
				<div class="news2abs"></div>
				<div class="news2source"></div>
			</div>					
			<div>
				<div class="news3title"><a href="" target="_blank"></a></div>
				<div class="news3abs"></div>
				<div class="news3source"></div>
			</div>
			<input type="hidden" name="id" value="" />
		</div>	
		
		
		
		<!--問號-->
		<div id="question_mark" class="readytofight col-md-5">
			<img class="question_mark img-responsive center-block" src="img/question_mark.jpg" />	
		</div>
		
		<div id="candidate_" class="readytofight col-md-5 candidate_per" value="">		
			<a id="image_" href="#"><img class="person_img img-responsive center-block" src="" alt=""></a>
			<hr class="hrline">		
			<div id="challengerName"></div>		
			<div id="challengerBrief" style="height:107px; overflow:hidden;"></div>
			<a  id="challengerWikiLink" href="" target="_blank">維基百科</a>			
			<div>
				<div id="challengernews1title" ><a href="" target="_blank"></a></div>
				<div id="challengernews1abs" ></div>
				<div id="challengernews1source" ></div>
			</div>					
			<div>
				<div id="challengernews2title" ><a href="" target="_blank"></a></div>
				<div id="challengernews2abs" ></div>
				<div id="challengernews2source" ></div>
			</div>					
			<div>
				<div id="challengernews3title" ><a href="" target="_blank"></a></div>
				<div id="challengernews3abs" ></div>
				<div id="challengernews3source" ></div>
			</div>  
		</div>
		
	</div>
	
	<div id="roundResult" class="container" style="display:none">
		<div id="opinion"></div>
		<div>我的選擇是：</div>
		<img id="imgResult" src=""/>
		<div id="nameResult"></div>
		<button id="shareResult" type="button" class="btn btn-default">分享此次結果到facebook</button>
		<button id="goToVote" type="button" class="btn btn-default">看看還有哪些勝出的候選人，接著投票去</button>
		<button id="playAgain" type="button" class="btn btn-default">再戰一次</button>
	</div>
<script type="text/javascript" src="js/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="alertifyjs/alertify.js"></script>
<script type="text/javascript">
//fb
window.fbAsyncInit = function() {
    FB.init({
          appId      : '1109820955698868',
          xfbml      : true,
          version    : 'v2.3'
    });
	FB.getLoginStatus(function(response) {
		if (response.status === 'connected' && !response.error) {
			var uid = response.authResponse.userID;
			var request_url="checkloginsession.php";
			$.ajax({
				url:request_url,  
				data:{
					fb_id:uid
				},
				type:"POST",	
				dataType:"text",
				success:function(str){
					$("body").css("display", "block");
				},
				async:false,
				error:function(){},
				beforeSend:function(){},
				complete:function(){
					
				}
			});
			
			
		} else if (response.status === 'not_authorized' && !response.error) {
			var request_url="logout.php";
			$.ajax({
				url:request_url,	
				dataType:"text",
				success:function(str){
					location="login.html";
				},
				async:false,
				error:function(){},
				beforeSend:function(){},
				complete:function(){}
			});
		} 
		else{
			var request_url="logout.php";
			$.ajax({
				url:request_url,	
				dataType:"text",
				success:function(str){
					location="login.html";
				},
				async:false,
				error:function(){},
				beforeSend:function(){},
				complete:function(){}
			});
		}
	});	
};

(function(d, s, id){
   var js, fjs = d.getElementsByTagName(s)[0];
   if (d.getElementById(id)) {return;}
   js = d.createElement(s); js.id = id;
   js.src = "//connect.facebook.net/en_US/sdk.js";
   fjs.parentNode.insertBefore(js, fjs);
 }(document, 'script', 'facebook-jssdk'));
	   

//隨機選出10個候選人
function random(nominatedman){
	//產生初始值
	if(nominatedman==null) var numFight=9;
	else if(nominatedman!=null) var numFight=10;
	var winner_array=[];
	var loser_array=[];
	var URLs="random.php";
	$.ajax({
		url:URLs,
		data:{
			name:nominatedman,
		},
		type:"POST",
		dataType:"json",
		success:function(json){
			for(var i=1; i<=10; i++){				
				$("#image_" + i + " > img").attr("src", json.img[i]);
				$("#candidate_" + i + " > .canName").text(json.name[i]);
				$("#candidate_" + i + " > .canBrief").html(json.brief[i]);
				$("#candidate_" + i + " > .canWikiLink").attr("href", "https://zh.wikipedia.org/wiki/" + json.name[i]);
				$("#candidate_" + i + " > div > .news1title a").html(json.title1[i]);
				$("#candidate_" + i + " > div > .news1title a").attr("href", json.link1[i]);
				$("#candidate_" + i + " > div > .news1abs").html(json.abs1[i]);
				$("#candidate_" + i + " > div > .news1source").html(json.press1[i]);
				$("#candidate_" + i + " > div > .news2title a").attr("href", json.link2[i]);
				$("#candidate_" + i + " > div > .news2title a").html(json.title2[i]);
				$("#candidate_" + i + " > div > .news2abs").html(json.abs2[i]);
				$("#candidate_" + i + " > div > .news2source").html(json.press2[i]);
				$("#candidate_" + i + " > div > .news3title a").attr("href", json.link3[i]);
				$("#candidate_" + i + " > div > .news3title a").html(json.title3[i]);
				$("#candidate_" + i + " > div > .news3abs").html(json.abs3[i]);
				$("#candidate_" + i + " > div > .news3source").html(json.press3[i]);	
			}
			//在按鈕中加入初始值
			var can_id=json.id;
			if(nominatedman!=null) can_id[11]=$("#candidate_11 > input").val();
			//console.log("random");
			//console.log(can_id);
			$("#image_1").on('click', function(e){
				choose($(e.target).closest(".candidate_per").attr('value'), 0, can_id, winner_array, loser_array ,numFight, 2);
			});
			$("#image_2").on('click', function(e){
				choose($(e.target).closest(".candidate_per").attr('value'), 0, can_id, winner_array, loser_array ,numFight, 2);
			});
		},
		beforeSend:function(){},
		complete:function(){}
	});
}
//觸發事件的function	
$(function(){
		
		/*onmouseover
		$("#image_left").on('mouseover', function(){
		mouseoverimage('left');
		});
		$("#image_right").on('mouseover', function(){
		mouseoverimage('right');
		});*/
		
		$("#confirmPersonality").on('click', function(){
			finishPersonality();
			var animationend='webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
			$("#personality_option").addClass('animated zoomOut').one(animationend, function(){
				$(this).css("display", "none");
				$(this).removeClass('animated zoomOut');
				$("#nominateProperOne").css("display", "block");
				$("#nominateProperOne").addClass('animated zoomIn').one(animationend, function(){
					$(this).removeClass('animated zoomIn');
				});
			});
		});
		
		
		$("#validate").on('click', function(){
			nominateproperman();
		});
		
		$("#shareResult").on('click', function(){
			location="realtimelist.html";
		})
		$("#goToVote").on('click', function(){
			location="realtimelist.html";
		});
		$("#playAgain").on('click', function(){
			location="fightgame.html";
		});
		
		$("#goToPlay").on('click', function(){
			random();
			var animationend='webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
			$("#nominateProperOne").addClass('animated zoomOut').one(animationend, function(){
				$(this).css("display", "none");
				$(this).removeClass('animated zoomOut');
				$("#game").css("display", "block");
				$("#game").addClass('animated zoomIn').one(animationend, function(){
					$(this).removeClass('animated zoomIn');
				});
			});	
		})
		
});
		

	
/*
function mouseoverimage(position){
	switch(position){
		case 'left':
			$("#image_left").addClass("animated bounce");
			$("#image_right").removeClass("animated bounce");
			break;
		case 'right':
			$("#image_right").addClass("animated bounce");
			$("#image_left").removeClass("animated bounce");
			break;
	}
}*/	
function nominateproperman(){
		$("#validate").unbind('click');
		$("#nominate_img").empty();
		$("#nominatetext").empty();
		$("#wait").html("認證中...");
		var nominate=($("#nominate_name").val());
		var request_url="nominate.php";	
		$.ajax({
			url:request_url,  
			data:{			 
				command:'NominatePreview',
				name:nominate,
			},
			type:"POST",
			dataType:"json",
			success:function(str){
			if(str.wiki==null) var string ='維基百科查無此人，為了資料的客觀性，必須提名維基百科有記載的人選';
			else{
				var string='<div>簡介：</div>'+
				'<div>' + str.wiki + '</div>';
				var person_img='<img src="' + str.img + '" alt="" />';
				$("#nominate_img").html(person_img);
				$("#submitNominate").on('click', function(){
					submitProperMan(str, nominate);
				});
				$("#nominateAction").css("display", "block");
			}
			$("#wait").empty();
			$("#nominatetext").html(string);
			},
			error:function(){},
			complete:function(){
				$("#validate").on('click', function(){
					nominateproperman();
				});
			}
		});	
} 

function submitProperMan(jsondata, man){
	//有參戰者之條件
	//傳入參戰者資料
	$("#image_11 > img").attr("src", jsondata.img);
	$("#candidate_11 > .canName").text(man);
	$("#candidate_11 > .canBrief").html(jsondata.wiki);
	$("#candidate_11 > .canWikiLink").attr("href", "https://zh.wikipedia.org/wiki/" + man);
	$("#candidate_11 > div > .news1title a").html(jsondata.news[1].title);
	$("#candidate_11 > div > .news1title a").attr("href", jsondata.news[1].link);
	$("#candidate_11 > div > .news1abs").html(jsondata.news[1].newsabtract);
	$("#candidate_11 > div > .news1source").html(jsondata.news[1].press);
	$("#candidate_11 > div > .news2title a").attr("href", jsondata.news[2].link);
	$("#candidate_11 > div > .news2title a").html(jsondata.news[2].title);
	$("#candidate_11 > div > .news2abs").html(jsondata.news[2].newsabtract);
	$("#candidate_11 > div > .news2source").html(jsondata.news[2].press);
	$("#candidate_11 > div > .news3title a").attr("href", jsondata.news[3].link);
	$("#candidate_11 > div > .news3title a").html(jsondata.news[3].title);
	$("#candidate_11> div > .news3abs").html(jsondata.news[3].newsabtract);
	$("#candidate_11 > div > .news3source").html(jsondata.news[3].press);
			var URLs="nominate.php";
            $.ajax({
                url: URLs,
                data: {
				command:'NominateInsert',
				name:man,
				img:jsondata.img,
				brief:jsondata.wiki,
				title_1:jsondata.news[1].title,
				link_1:jsondata.news[1].link,
				abs_1:jsondata.news[1].newsabtract,
				press_1:jsondata.news[1].press,
				title_2:jsondata.news[2].title,
				link_2:jsondata.news[2].link,
				abs_2:jsondata.news[2].newsabtract,
				press_2:jsondata.news[2].press,
				title_3:jsondata.news[3].title,
				link_3:jsondata.news[3].link,
				abs_3:jsondata.news[3].newsabtract,
				press_3:jsondata.news[3].press,				
				},
                type:"POST",
                dataType:'text',
                success: function(str){
						$("#candidate_11 > input").val(str);
						random(man);
						console.log(str);
						var animationend='webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
						$("#nominateProperOne").addClass('animated zoomOut').one(animationend, function(){
							$(this).css("display", "none");
							$(this).removeClass('animated zoomOut');
							$("#game").css("display", "block");
							$("#game").addClass('animated zoomIn').one(animationend, function(){
								$(this).removeClass('animated zoomIn');
							});
						});
						alertify.warning('開始戰鬥!!');
				},
                beforeSend:function(){},
                complete:function(){},
                error:function(){}
            });

}
	

function choose(winner, numberclick, candidate_id, winner_id, loser_id, fight_num, newcan_order){
		//console.log("winner:" + winner);
		
		//console.log("candidate_id:" + candidate_id[newcan_order]);

		//console.log("fight_num:" + fight_num);
		//console.log("newcan_order:" + newcan_order);
		
		numberclick=numberclick+1;
		//console.log("numberclick:" + numberclick);
		var leftside='left';//左側戰鬥者類別
		var rightside='right';//右側戰鬥者類別
		//var left_order=$("." + leftside).attr('id').substr(10, 2);
		//var right_order=$("." + rightside).attr('id').substr(10, 2);
		//var winner_order=winner.substr(6, 2);
		var left_order=$("." + leftside).attr('value');
		var right_order=$("." + rightside).attr('value');
		var winner_order=winner;
		if(winner_order==left_order){
			var loser_order=right_order;
			var loser_position=rightside;
			}
		else{
			var loser_order=left_order;
			var loser_position=leftside;
			}
		//點擊功能暫時失效
		$("#image_" + left_order).unbind('click');
		$("#image_" + right_order).unbind('click');
		//將對戰紀錄存入winner_id、loser_id
		winner_id[numberclick]=candidate_id[winner_order];
		loser_id[numberclick]=candidate_id[loser_order];
		
		console.log(winner_id);
		console.log(loser_id);
		//當對戰沒結束，呈現新的候選人
		if(numberclick<fight_num){
			//當有使用者提出的候選人時
			if(numberclick==9){
			//console.log("王牌");
				newcan_order=newcan_order+1;
				var animationend='webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
				var outanimation='animated zoomOut';//出去的效果類別
				var inanimation='animated slideInDown';//進來的效果類別
				var special="animated flash";
				var nonfighter='readytofight';//非參與者類別
				$("#candidate_" + loser_order).addClass(outanimation).one(animationend, function(){
					$(this).removeClass(outanimation+ ' ' + loser_position);
					$(this).addClass(nonfighter);
				
					//更新
					$("#candidate_" + newcan_order).removeClass(nonfighter);
					$("#candidate_" + newcan_order).addClass(inanimation+ ' ' +　loser_position).one(animationend, function(){
						$(this).removeClass(inanimation);
						$(this).addClass(special).one(animationend, function(){
							$(this).removeClass(special);
							alertify.warning('經過一番激戰，最後與你心目中的人選較量!!');
							//將click功能加上去
							$("#image_" + winner_order).on('click', function(e){
							choose($(e.target).closest(".candidate_per").attr('value'), numberclick, candidate_id, winner_id, loser_id, fight_num, newcan_order);
							});
							$("#image_" + newcan_order).on('click', function(e){
							choose($(e.target).closest(".candidate_per").attr('value'), numberclick, candidate_id, winner_id, loser_id, fight_num, newcan_order);
							});
						});
					});
				});
			}
			else{
				newcan_order=newcan_order+1;
				var animationend='webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
				var outanimation='animated zoomOut';//出去的效果類別
				var inanimation='animated bounceIn';//進來的效果類別
				var nonfighter='readytofight';//非參與者類別
				//淘汰
				$("#candidate_" + loser_order).addClass(outanimation).one(animationend, function(){
					$(this).removeClass(outanimation+ ' ' + loser_position);
					$(this).addClass(nonfighter);
					//問號出現
					$('#question_mark').removeClass(nonfighter);
					$('#question_mark').addClass('animated flip'+ ' ' +　loser_position).one(animationend, function(){
					$(this).removeClass(outanimation+ ' ' + loser_position);
					$(this).addClass(nonfighter);
					
						//更新
						$("#candidate_" + newcan_order).removeClass(nonfighter);
						$("#candidate_" + newcan_order).addClass(inanimation+ ' ' +　loser_position).one(animationend, function(){
						$(this).removeClass(inanimation);
						
						//將click功能加上去
						$("#image_" + winner_order).on('click', function(e){
							choose($(e.target).closest(".candidate_per").attr('value'), numberclick, candidate_id, winner_id, loser_id, fight_num, newcan_order);
							});
						$("#image_" + newcan_order).on('click', function(e){
							choose($(e.target).closest(".candidate_per").attr('value'), numberclick, candidate_id, winner_id, loser_id, fight_num, newcan_order);
							});
						});
					});
				});
			}
		}
		//當對戰結束時
		else{
		//存入對戰紀錄，並顯示投票箱及分享框
		//var finalwinnerid=winner_id[fight_num];
		var request_url = "savefight.php";				
		$.ajax({
			url:request_url,  
			data:{
				winner_array:JSON.stringify(winner_id),
				loser_array:JSON.stringify(loser_id),
			},
			type:"POST",	
			dataType:"text",
			success:function(str){
				if(str=='login') finishGame(winner_order);
				else {
				alertify.error('閒置時間過久，重新驗證中...');
				location="vote_index.php";
				}
			},
			async:true,
			error:function(){},
			complete:function(){}
			});
		}
}

function finishPersonality(){
	var opinion=collectPersonality();
	opinion = opinion + "，有沒有心目中的秘密人選想參戰?";
	$("#opinionN").html(opinion);
	
}

function collectPersonality(){
	var myopinion=[];
	for(var t=0; t<$(".listcheckbox > input").length; t++){
		var listcanobj=$($(".listcheckbox > input").get(t));
		if(listcanobj.prop("checked")){
			myopinion.push(listcanobj.attr('value'));
		}
	}
	if(myopinion.length!=0){
		var opinionString= myopinion[0];
		for(var t=1; t<myopinion.length; t++){
			opinionString= opinionString + '、' + myopinion[t];
		}
		opinionString="我認為成為一個好的總統候選人應該具備「" + opinionString + "」的特質";
	}
	else{
		opinionString="";
	}
	return opinionString; 
}

function finishGame(roundwinner){
	var animationend='webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
	var name=$("#candidate_" + roundwinner + " > .canName").text();
	var img=$("#image_" + roundwinner + " > img").attr("src");
	var wiki=$("#candidate_" + roundwinner + " > .canBrief").html();
	//console.log(name);
	//console.log(img);
	$("#imgResult").attr("src", img);
	$("#nameResult").html(name);
	var myopinion=[];
	for(var t=0; t<$(".listcheckbox > input").length; t++){
		var listcanobj=$($(".listcheckbox > input").get(t));
		if(listcanobj.prop("checked")){
			myopinion.push(listcanobj.attr('value'));
		}
	}
	if(myopinion.length!=0){
		var opinionString= myopinion[0];
		for(var t=1; t<myopinion.length; t++){
			opinionString= opinionString + '、' + myopinion[t];
		}
		opinionString="我認為成為一個好的總統候選人應該具備「" + opinionString + "」的特質";
	}
	else{
		opinionString="";
	}
	//addListString=name + "已經加入我的選秀名單";
	$("#opinion").html(opinionString);
	//$("#addList").html(addListString);
	$("#game").addClass('animated zoomOut').one(animationend, function(){
		$(this).css("display", "none");
		$(this).removeClass('animated zoomOut');
		$("#roundResult").css("display", "block");
		$("#roundResult").addClass('animated zoomIn').one(animationend, function(){
			$(this).removeClass('animated zoomIn');
		});
	});
}
/*
function checkmybox(fwinnerid){
			$('#favotite_one').unbind('click');
			$('#favorite_one').unbind('mouseover');
			$('#favorite_two').unbind('click');
			$('#favorite_two').unbind('mouseover');
			$('#favorite_three').unbind('click');
			$('#favorite_three').unbind('mouseover');
			var request_url = "mybox.php";
			$.ajax({
			url:request_url,  
			data:{
				action:'check',
				user:user_id,
				fwinner:fwinnerid
			},
			type:"POST",	
			dataType:"text",
			success:function(str){
			if(str=='qualified'){
				var animationend='webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
				$('#favorite_one').on('mouseover', function(){
				$(this).addClass('animated bounce').one(animationend,function(){
				$(this).removeClass('animated bounce');
				});
				});
				$('#favorite_one').on('click', function(){
				updatemybox($(this).attr('value'));
				});
				$('#favorite_two').on('mouseover', function(){
				$(this).addClass('animated bounce').one(animationend,function(){
				$(this).removeClass('animated bounce');
				});
				});
				$('#favorite_two').on('click', function(){
				updatemybox($(this).attr('value'));
				});
				$('#favorite_three').on('mouseover', function(){
				$(this).addClass('animated bounce').one(animationend,function(){
				$(this).removeClass('animated bounce');
				});
				});
				$('#favorite_three').on('click', function(){
				updatemybox($(this).attr('value'));
				});
				}
			},
			async:true,
			error:function(){},
			complete:function(){}
			});	
		}
function loadmybox(){
		var request_url = "mybox.php";				
		$.ajax({
			url:request_url,  
			data:{
				action:'load',
				user:user_id
			},
			type:"POST",	
			dataType:"json",
			success:function(str){
			if (str[1]!=null) $("#favorite_one").attr('src', str[1]);
			if (str[2]!=null) $("#favorite_two").attr('src', str[2]);
			if (str[3]!=null) $("#favorite_three").attr('src', str[3]);
			},
			async:true,
			error:function(){},
			beforeSend:function(){},
			complete:function(){}
			});
}
function updatemybox(position){
		$('#favotite_one').unbind('click');
		$('#favorite_one').unbind('mouseover');
		$('#favorite_two').unbind('click');
		$('#favorite_two').unbind('mouseover');
		$('#favorite_three').unbind('click');
		$('#favorite_three').unbind('mouseover');
		var finalwinnerid=winner_id[fight_num];
		var request_url = "myfavorite.php";				
		$.ajax({
			url:request_url,
			data:{
				action:'update',
				fwinner:finalwinnerid,
				personposition:position,
				user:user_id
			},
			type:"POST",	
			dataType:"text",
			success:function(str){
			//checkmybox(finalwinnerid);
			loadmybox();
			},
			async:true,
			error:function(){},
			complete:function(){}
			});
		}*/
//define a new dialog
if(!alertify.myAlert){
  alertify.dialog('myAlert',function(){
    return{
      main:function(message){
        this.message = message;
      },
      setup:function(){
          return { 
            buttons:[{text: "cool!", key:27/*Esc*/}],
            focus: { element:0 }
          };
      },
      prepare:function(){
        this.setContent(this.message);
      }
  }});
}
</script>
</body>
</html>